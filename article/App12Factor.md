# APP 12 factor

## 网络应用程序,Sass 服务软件

- 标准化流程自动配置, 减少加入项目的人，学习成本
- 操作系统隔离, 提高可抑制的特性
- 云平台可部署, 节省资源管理
- 开发生产环境差异降低， 持续交付
- 工具，架构, 开发流程不变， 实现扩展

## CodeBase

- 一份代码,不同的部署
  - 多个基础代码，不能单个应用
  - 一个App,一个基础代码。 通过依赖, 解决代码的共享
- 一份代码多个部署, 不同环境不同的部署。 (防止代码的差异, 环境的异同)

## 依赖配资

- App 不会隐式的依赖 系统级别的类库, 通过依赖清单, 明确的申明依赖 （防止不同环境的 系统差异）
- 不采用 隐式的依赖工具, curl

## 配置环境

- 不同环境, 配置差异很大
  - 数据库, memcache, 后端服务的配置
  - 三方证书, twitter, Amazon 等
  - 每份环境, 不同的配置
- 配置 强代码中-配置文件中。 是否敏感信息
- 统一配置文件, 不同环境的配置, 粒度小, 相互之间没有关联的信息

## 后端服务

- 服务依赖的后台服务 DB, MQ, Cache, SMTP, 等
- 不区别对待, 本地服务, 三方服务
  - 解决资源的强依赖, MYSQL - Amson-RDS 上层无感知切换

## 严格构建，发布，运行

- 构建，发布，运行 过程
  - 构建 CodeBase 转换可执行包, 指定代码版本, 获取依赖包, 编译文件, 资源文件
  - 发布 可执行包, 添加不同的环境配置文件
  - 运行 执行环境运行
- 严格 构建,发布,运行的 流程
- 版本回退： 版本发布， 生成Timestamp, 生成version, 提供回退等 版本控制

## 进程（App 的进程必须无状态， 不共享的）

- 数据持久化, session redis, session 服务等。 data 后端SQL 数据库

## 端口绑定方使 提供服务依赖

- app 8080

## 并发， 进程, 线程的并发方使， 不同的Job

## 进程服务 易处理， 易重启，停止

- 有利快速, 弹性的伸缩
- 进程最小启动时间
- 一旦接收 终止信号（SIGTERM） 就会优雅的终止
  - http 拒绝链接请求
  - worker 停止请求, 释放资源。 (!! 可重复执行, 结果事物添加, 密等 的实现)
  - 在面对突然死亡时保持健壮

## 开发环境 生产环境的一致性

- 开发线上差异
  - 时间
  - 人员
  - 工具
- 通过持续部署方式, 缩小本地线上的差异

| diff      |    传统应用 | 12-Factor 应用  |
| :-------- | :------ | :--: |
|每次部署间隔 | 数周 | 几小时|
|开发人员 vs 运维人员 | 不同的人 | 相同的人|
|开发环境 vs 线上环境 | 不同 | 尽量接近|

- 后端服务 环境的一致性
  - 通过封装 jdbc 等, 封装 不同SQL 请求。 不同的Adapter 适配
- 12-Factor 应用的开发人员应该反对在不同环境间使用不同的后端服务

## 日志（实时的输出流， 日志分析工具）

- 实时的日志输出, 监控当前的应用状态
- Hadoop/Hive 分析日志
  - 找出过去一段时间特殊的事件。
  - 图形化一个大规模的趋势，比如每分钟的请求量。
  - 根据用户定义的条件实时触发警报，比如每分钟的报错超过某个警戒线。

## 管理进程

- 标准进程, 提供服务的一些进程。 web 处理请求等
- 添加一些 一次性任务，管理，校验任务
  - 数据移植
  - 控制台 Shell
  - 代码脚本等
